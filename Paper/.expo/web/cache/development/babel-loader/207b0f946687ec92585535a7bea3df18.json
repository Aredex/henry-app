{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport Axios from \"axios\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\nimport { authSetError, login, logout } from \"../actions/auth\";\nimport Expo from \"expo\";\nimport { finishLoading, startLoading } from \"../actions/ui\";\nexport var signOut = function signOut() {\n  return function _callee(dispatch) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            dispatch(startLoading());\n            dispatch(logout());\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"token\"));\n\n          case 4:\n            dispatch(finishLoading());\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\nexport var initialize = function initialize(localUser) {\n  Axios.defaults.baseURL = \"http://localhost:3001\";\n\n  if (localUser && localUser.token) {\n    Axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + localUser.token;\n  } else {\n    Axios.defaults.headers.common[\"Authorization\"] = \"\";\n  }\n};\nexport var signInWithEmail = function signInWithEmail(username, password) {\n  return function _callee2(dispatch) {\n    var _await$Axios$post, data, user, token, response;\n\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            dispatch(startLoading());\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(Axios.post(\"http://localhost:3001\" + \"/auth/email\", {\n              username: username,\n              password: password\n            }));\n\n          case 4:\n            _await$Axios$post = _context2.sent;\n            data = _await$Axios$post.data;\n\n            if (!data) {\n              _context2.next = 12;\n              break;\n            }\n\n            user = data.user, token = data.token;\n            _context2.next = 10;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"token\", token));\n\n          case 10:\n            dispatch(login(user.id, user, token));\n            dispatch(finishLoading());\n\n          case 12:\n            _context2.next = 20;\n            break;\n\n          case 14:\n            _context2.prev = 14;\n            _context2.t0 = _context2[\"catch\"](1);\n            response = _context2.t0.response;\n            dispatch(signOut());\n            dispatch(authSetError(response.data.message));\n            dispatch(finishLoading());\n\n          case 20:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 14]], Promise);\n  };\n};\nexport var signInWithToken = function signInWithToken(token) {\n  return function _callee3(dispatch) {\n    var _await$Axios$get, data, response;\n\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            dispatch(startLoading());\n            _context3.prev = 1;\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(Axios.get(\"http://localhost:3001\" + \"/auth/me\", {\n              headers: {\n                Authorization: \"Bearer \" + token\n              }\n            }));\n\n          case 4:\n            _await$Axios$get = _context3.sent;\n            data = _await$Axios$get.data;\n\n            if (!data) {\n              _context3.next = 11;\n              break;\n            }\n\n            _context3.next = 9;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"token\", token));\n\n          case 9:\n            dispatch(login(data.id, data, token));\n            dispatch(finishLoading());\n\n          case 11:\n            _context3.next = 19;\n            break;\n\n          case 13:\n            _context3.prev = 13;\n            _context3.t0 = _context3[\"catch\"](1);\n            response = _context3.t0.response;\n            dispatch(signOut());\n            dispatch(authSetError(response.data.message));\n            dispatch(finishLoading());\n\n          case 19:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 13]], Promise);\n  };\n};\nexport var signInWithGoogle = function signInWithGoogle() {\n  return function _callee4(dispatch) {\n    var result;\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            dispatch(startLoading());\n            _context4.prev = 1;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(Expo.Google.logInAsync({\n              androidClientId: \"833456763323-ig9ndr0tbvb62jv4ddn6j8pos3a49m35.apps.googleusercontent.com\",\n              scopes: [\"profile\", \"email\"]\n            }));\n\n          case 4:\n            result = _context4.sent;\n\n            if (result.type === \"success\") {\n              console.log(result);\n            } else {\n              console.log(\"cancelled\");\n            }\n\n            _context4.next = 11;\n            break;\n\n          case 8:\n            _context4.prev = 8;\n            _context4.t0 = _context4[\"catch\"](1);\n            console.log(\"error,\", _context4.t0);\n\n          case 11:\n            dispatch(finishLoading());\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[1, 8]], Promise);\n  };\n};\nexport var signInWithGithub = function signInWithGithub() {\n  if (window) {\n    window.location = \"http://localhost:3001\" + \"/auth/github\";\n  }\n};","map":{"version":3,"sources":["/home/aredex/HENRY/henry-app/Paper/src/dispatchers/auth.js"],"names":["Axios","AsyncStorage","authSetError","login","logout","Expo","finishLoading","startLoading","signOut","dispatch","removeItem","initialize","localUser","defaults","baseURL","token","headers","common","signInWithEmail","username","password","post","data","user","setItem","id","response","message","signInWithToken","get","Authorization","signInWithGoogle","Google","logInAsync","androidClientId","scopes","result","type","console","log","signInWithGithub","window","location"],"mappings":"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","sourcesContent":["import Axios from \"axios\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\nimport { authSetError, login, logout } from \"../actions/auth\";\nimport Expo from \"expo\";\n\nimport { REACT_APP_API } from \"@env\";\nimport { finishLoading, startLoading } from \"../actions/ui\";\n\nexport const signOut = () => {\n  return async (dispatch) => {\n    dispatch(startLoading());\n    dispatch(logout());\n    await AsyncStorage.removeItem(\"token\");\n    dispatch(finishLoading());\n  };\n};\n\nexport const initialize = (localUser) => {\n  Axios.defaults.baseURL = REACT_APP_API;\n\n  if (localUser && localUser.token) {\n    Axios.defaults.headers.common[\n      \"Authorization\"\n    ] = `Bearer ${localUser.token}`;\n  } else {\n    Axios.defaults.headers.common[\"Authorization\"] = ``;\n  }\n};\n\nexport const signInWithEmail = (username, password) => {\n  return async (dispatch) => {\n    dispatch(startLoading());\n    try {\n      const { data } = await Axios.post(`${REACT_APP_API}/auth/email`, {\n        username,\n        password,\n      });\n\n      if (data) {\n        const { user, token } = data;\n\n        await AsyncStorage.setItem(\"token\", token);\n        dispatch(login(user.id, user, token));\n        dispatch(finishLoading());\n      }\n    } catch ({ response }) {\n      dispatch(signOut());\n      dispatch(authSetError(response.data.message));\n      dispatch(finishLoading());\n    }\n  };\n};\n\nexport const signInWithToken = (token) => {\n  return async (dispatch) => {\n    dispatch(startLoading());\n    try {\n      const { data } = await Axios.get(`${REACT_APP_API}/auth/me`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      if (data) {\n        await AsyncStorage.setItem(\"token\", token);\n        dispatch(login(data.id, data, token));\n        dispatch(finishLoading());\n      }\n    } catch ({ response }) {\n      dispatch(signOut());\n      dispatch(authSetError(response.data.message));\n      dispatch(finishLoading());\n    }\n  };\n};\n\nexport const signInWithGoogle = () => {\n  // if (window) {\n  //   window.location = `${REACT_APP_API}/auth/google`;\n  // }\n\n  return async (dispatch) => {\n    dispatch(startLoading());\n    try {\n      const result = await Expo.Google.logInAsync({\n        androidClientId:\n          \"833456763323-ig9ndr0tbvb62jv4ddn6j8pos3a49m35.apps.googleusercontent.com\",\n        //iosClientId: YOUR_CLIENT_ID_HERE,  <-- if you use iOS\n        scopes: [\"profile\", \"email\"],\n      });\n      if (result.type === \"success\") {\n        console.log(result);\n      } else {\n        console.log(\"cancelled\");\n      }\n    } catch (e) {\n      console.log(\"error,\", e);\n    }\n    dispatch(finishLoading());\n  };\n};\n\nexport const signInWithGithub = () => {\n  if (window) {\n    window.location = `${REACT_APP_API}/auth/github`;\n  }\n};\n"]},"metadata":{},"sourceType":"module"}